#!/usr/bin/env bash

set -euo pipefail

APPS_DIR="$HOME/apps"
EXTRA_DIRS=(
  "$HOME/.config/nvim"
  "$HOME/.dotfiles"
)

pick_session() {
  local apps extra all
  apps=$(fd . "$APPS_DIR" --max-depth=2 --min-depth=2 --type d || true)
  extra=$(printf "%s\n" "${EXTRA_DIRS[@]}")
  all=$(printf "%s\n%s\n" "$apps" "$extra")

  echo "$all" | fzf \
    --border rounded \
    --height 100% \
    --exit-0 \
    --preview 'eza {} --color=always --icons -l --group-directories-first --no-user --no-time --no-filesize --no-permissions'
}

if [[ $# -eq 1 ]]; then
  selected=$1
else
  selected=$(pick_session || true)
fi

[[ -z ${selected:-} ]] && exit 0

selected_path=$(realpath "$selected")
selected_name=$(basename "$selected_path" | tr . _)

exec tconnect "$selected_path" "$selected_name"
