#!/bin/sh
set -eu

pick_session() {
  {
    fd . "$HOME/apps" --max-depth=2 --min-depth=2 --type d 2>/dev/null
    printf "%s\n" "$HOME/.config/nvim" "$HOME/.dotfiles"
  } | fzf \
    --border rounded \
    --height 100% \
    --exit-0 \
    --preview 'eza {} --color=always --icons -l --group-directories-first --no-user --no-time --no-filesize --no-permissions'
}

selected=${1:-$(pick_session)}

[ -z "$selected" ] && exit 0

selected_path=$(realpath "$selected")
selected_name=$(basename "$selected_path" | tr . _)

exec tconnect "$selected_path" "$selected_name"
